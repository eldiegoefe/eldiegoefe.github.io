<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Uso de MBED desde la linea de comandos (CLI) | Certezas Dudosas</title>
<meta name="keywords" content="mbed, c&#43;&#43;, emacs, electronica, tutorial">
<meta name="description" content="Empecé a probar el uso de la plataforma MBED con la placa FRDM-K64F. Hasta ahora
usaba la versión online del compilador con una
FRDM-KL25Z, que es una (de las primeras en funcionar con MBED). El problema del
compilador online no es que haya que estar conectado a la web (lo vengo usando
desde hace mucho y nunca tuve problemas de acceso) sino sus limitadas
prestaciones como editor de texto. Por ejemplo, no encontré manera de comentar y
des-comentar múltiples lineas de código simultaneamente, algo que necesito hacer
con frecuencia. Por esto mismo prefiero el editor que uso para el resto de mis
actividades: Emacs, y esto lo puedo hacer con el nuevo compilador offline.">
<meta name="author" content="Diego Efe">
<link rel="canonical" href="http://localhost:1313/posts/emacs/2016-11-04-mbed-cli/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/emacs/2016-11-04-mbed-cli/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Certezas Dudosas (Alt + H)">Certezas Dudosas</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Uso de MBED desde la linea de comandos (CLI)
    </h1>
    <div class="post-meta"><span title='2016-11-04 10:00:00 +0000 UTC'>November 4, 2016</span>&nbsp;·&nbsp;<span>Diego Efe</span>

</div>
  </header> 
  <div class="post-content"><p>Empecé a probar el uso de la plataforma MBED con la placa FRDM-K64F. Hasta ahora
usaba <a href="https://developer.mbed.org/">la versión online del compilador</a> con una
FRDM-KL25Z, que es una (de las primeras en funcionar con MBED). El problema del
compilador online no es que haya que estar conectado a la web (lo vengo usando
desde hace mucho y nunca tuve problemas de acceso) sino sus limitadas
prestaciones como editor de texto. Por ejemplo, no encontré manera de comentar y
des-comentar múltiples lineas de código simultaneamente, algo que necesito hacer
con frecuencia. Por esto mismo prefiero el editor que uso para el resto de mis
actividades: Emacs, y esto lo puedo hacer con el nuevo compilador offline.</p>
<p>Las instrucciones para usar el compilador desde la linea de comandos (mbed-cli)
las extraje del video que está más abajo y de la documentación. Sin embargo lo
resumo en esta entrada para tener el paso-a-paso como referencia rápida. Por
esto mismo, hay mucha información que no está incluida en este post y que pueden
encontrar en la <a href="https://docs.mbed.com/docs/mbed-os-handbook/en/5.1/dev_tools/cli/">documentación de
mbed-cli</a>
(como por ejemplo las instrucciones de instalación).</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/PI1Kq9RSN_Y?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"></iframe>
    </div>

<h2 id="inicializar-un-nuevo-programa">Inicializar un nuevo programa<a hidden class="anchor" aria-hidden="true" href="#inicializar-un-nuevo-programa">#</a></h2>
<p>Al inicializar un nuevo programa se crea un directorio con el nombre que
le asignamos. Este directorio aparece como hijo de nuestro directorio
actual, así que antes de ejecutar el comando hay que posicionarse en la
ubicación deseada.</p>
<h3 id="para-mbed-os-5">Para MBED OS 5<a hidden class="anchor" aria-hidden="true" href="#para-mbed-os-5">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ mbed new nombre-programa
</span></span><span style="display:flex;"><span>$ cd nombre-programa
</span></span></code></pre></div><h3 id="para-mbed-os-2">Para MBED OS 2<a hidden class="anchor" aria-hidden="true" href="#para-mbed-os-2">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ mbed new nombre-programa --mbedlib
</span></span><span style="display:flex;"><span>$ cd nombre-programa
</span></span></code></pre></div><h2 id="mostrar-las-librerías-instaladas">Mostrar las librerías instaladas<a hidden class="anchor" aria-hidden="true" href="#mostrar-las-librerías-instaladas">#</a></h2>
<p>Al inicializarse un programa, como mínimo se importan las librerías de
MBED, ya sean las del OS 5 o del OS 2 (son diferentes entre sí). Para
verlas:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ mbed ls -a
</span></span></code></pre></div><h2 id="selección-de-placa-y-toolchain">Selección de placa y toolchain<a hidden class="anchor" aria-hidden="true" href="#selección-de-placa-y-toolchain">#</a></h2>
<p>Hay que conectar la placa MBED mediante su conector USB <strong>OpenSDA</strong> (el
que se usa para programarla) y ejecutar el siguiente comando, que nos
dará información que necesitaremos para seleccionar placa y toolchain:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ mbed detect
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[mbed] Detected K64F, port /dev/ttyACM0, mounted /media/diego/MBED
</span></span><span style="display:flex;"><span>[mbed] Supported toolchains for K64F
</span></span><span style="display:flex;"><span>+--------+-----------+-----------+-----------+-----------+-----------+
</span></span><span style="display:flex;"><span>| Target | mbed OS 2 | mbed OS 5 |    ARM    |  GCC_ARM  |    IAR    |
</span></span><span style="display:flex;"><span>+--------+-----------+-----------+-----------+-----------+-----------+
</span></span><span style="display:flex;"><span>| K64F   | Supported | Supported | Supported | Supported | Supported |
</span></span><span style="display:flex;"><span>+--------+-----------+-----------+-----------+-----------+-----------+
</span></span><span style="display:flex;"><span>Supported targets: 1
</span></span><span style="display:flex;"><span>Supported toolchains: 3
</span></span></code></pre></div><p>El sistema indica que encontró la K64F y cuáles son los <em>toolchains</em> que
disponemos para trabajar con ella. <strong>Si conecto la placa KL25Z el
sistema no la detecta, parece que el sistema sólo es compatible con las
placas más nuevas</strong>.</p>
<p>Para seleccionar la placa de destino donde correrá nuestro programa:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ mbed target K64F
</span></span></code></pre></div><p>Para elegir el toolchain GCC_ARM usamos:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ mbed toolchain GCC_ARM
</span></span></code></pre></div><p>Si pedimos el estado actual de la configuración veremos lo siguiente (si
la ejecución del comando <em>mbed new</em> se realizó desde
/home/diego/mis-proyectos):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ mbed config --list
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[mbed] Global config:
</span></span><span style="display:flex;"><span>No global configuration is set
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[mbed] Local config (/home/diego/mis-proyectos/nombre-programa):
</span></span><span style="display:flex;"><span>TOOLCHAIN=GCC_ARM
</span></span><span style="display:flex;"><span>TARGET=K64F
</span></span></code></pre></div><h2 id="creación-de-programa">Creación de programa<a hidden class="anchor" aria-hidden="true" href="#creación-de-programa">#</a></h2>
<p>En el directorio raíz del proyecto es necesario crear un archivo llamado
<em>main.cpp</em> que contendrá el programa escrito en C++. Por ejemplo, este
programa enciende y apaga un LED de la placa (usando OS 2):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;mbed.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>DigitalOut <span style="color:#a6e22e">rojo</span>(LED1);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">togglearLed</span>(DigitalOut led)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    led <span style="color:#f92672">=</span> <span style="color:#f92672">!</span>led;
</span></span><span style="display:flex;"><span>    wait(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">// togglearLed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span>(<span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        togglearLed(rojo);
</span></span><span style="display:flex;"><span>        togglearLed(rojo);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="compilación-y-ejecución-del-programa">Compilación y ejecución del programa<a hidden class="anchor" aria-hidden="true" href="#compilación-y-ejecución-del-programa">#</a></h2>
<p>La compilación se realiza con el siguiente comando:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ mbed compile
</span></span></code></pre></div><p><strong>Luego hay que copiar el archivo generado por el compilador en la placa
MBED</strong>. Este archivo (cuyo nombre corresponde al utilizado durante la
inicialización del proyecto: &quot;nombre-programa&quot; y cuya extensión es
.bin) se encuentra dentro del directorio BUILD/K64F/GCC_ARM. Obviamente
este path corresponde a la placa y al toolchain elegidos en un paso
anterior. La placa MBED aparece como un disco en el navegador de
archivos. En Linux Mint 18 este disco está montado en /media/diego/MBED.</p>
<p>Luego hay que esperar que se produzca la transferencia del archivo .bin
hacia la placa MBED (parpadea un LED verde que está junto al conector
USB de la placa) y tras algunos segundos (siempre se abre un nuevo
navegador de archivos, como cuando conectamos un pendrive, en la
ubicación del MBED) podemos resetear la placa para que se inicie la
ejecución de nuestro programa. Si cargamos el programa que está copiado
en el paso anterior veremos parpadear el led rojo a una frecuencia de
0.5 Hz.</p>
<p>Si modificamos el programa en main.cpp hay que volver a compilarlo,
copiar el nombre-programa.bin hacia la placa MBED, esperar que se
complete la transferencia y resetearla. Este es el bucle que repetiremos
hasta lograr que nuestro programa funcione de la manera deseada.</p>
<h2 id="resumen">Resumen<a hidden class="anchor" aria-hidden="true" href="#resumen">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ mbed new nombre-programa <span style="color:#f92672">(</span>--mbedlib<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>$ cd nombre-programa
</span></span><span style="display:flex;"><span>$ mbed ls -a
</span></span><span style="display:flex;"><span>$ mbed detect
</span></span><span style="display:flex;"><span>$ mbed target K64F
</span></span><span style="display:flex;"><span>$ mbed toolchain GCC_ARM
</span></span><span style="display:flex;"><span>$ mbed config --list
</span></span><span style="display:flex;"><span>$ mbed compile
</span></span></code></pre></div><p>Finalmente copiar el archivo .bin al MBED, esperar que finalice la
transferencia y resetear la placa.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/mbed/">Mbed</a></li>
      <li><a href="http://localhost:1313/tags/c&#43;&#43;/">C&#43;&#43;</a></li>
      <li><a href="http://localhost:1313/tags/emacs/">Emacs</a></li>
      <li><a href="http://localhost:1313/tags/electronica/">Electronica</a></li>
      <li><a href="http://localhost:1313/tags/tutorial/">Tutorial</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Certezas Dudosas</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
